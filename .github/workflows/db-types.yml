name: Supabase DB Types Consistency

on:
  push:
    paths:
      - "supabase/**"
      - "app/types/lib/database.types.ts"
      - "package.json"
      - "package-lock.json"
  pull_request:
    paths:
      - "supabase/**"
      - "app/types/lib/database.types.ts"
      - "package.json"
      - "package-lock.json"
  workflow_dispatch:

jobs:
  db-types:
    name: Validate Supabase types
    runs-on: ubuntu-latest
    # env:
    #   SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
    #   SUPABASE_PROJECT_ID: ${{ vars.SUPABASE_PROJECT_ID }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js 22.x
        uses: actions/setup-node@v4
        with:
          node-version: 22.x
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      # - name: Generate Supabase database types
      #   run: |
      #     npx supabase gen types \
      #       --lang=typescript \
      #       --project-id "$SUPABASE_PROJECT_ID" \
      #       --schema public \
      #       > app/types/lib/database.types.ts

      # - name: Check for drift in generated types
      #   run: |
      #     if ! git diff --quiet app/types/lib/database.types.ts; then
      #       echo "::error::Supabase generated types differ from committed version."
      #       git diff -- app/types/lib/database.types.ts
      #       exit 1
      #     fi
      #   shell: bash
