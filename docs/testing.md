# テスト設計書

## 概要

本ドキュメントは Singularity Lab Portal アプリケーションのテスト設計について記載します。

## テスト戦略

### テストピラミッド

```
    E2E Tests (少数)
  Integration Tests (中程度)
Unit Tests (多数) - Component Tests
```

## テスト項目一覧

### APIサービス層の単体テスト（高優先度）

データの整合性とビジネスロジックの正確性を確保する

#### テストポイント:

- **CRUD操作**: 作成・読込・更新・削除の正常動作
- **バリデーション**: 入力値検証とエラーハンドリング
- **権限チェック**: 認証・認可の適切な制御
- **エラー処理**: ネットワークエラー、DB制約違反時の適切な処理
- **戻り値**: 期待する型・構造でのレスポンス

#### 対象領域:

- ドキュメント管理機能（登録・削除）
- ユーザー管理機能（新規登録・ステータス取得）
- データ取得機能（一覧・詳細）

### セキュリティテスト（高優先度）

認証・認可システムの安全性を確保する

#### テストポイント:

- **認証制御**: 未認証ユーザーのアクセス阻止
- **認可制御**: ロール別機能制限（管理者・メンバー）
- **データアクセス**: Row Level Security (RLS) による適切なデータ分離
- **セッション管理**: ログイン状態の正確な管理

### 型安全性テスト（高優先度）

TypeScript型定義の整合性を確保する

#### テストポイント:

- **データベース型**: スキーマと型定義の一致
- **API契約**: リクエスト・レスポンス型の整合性
- **コンポーネント型**: Props型定義の正確性

### ビルドテスト（高優先度）

本番デプロイ前のビルドエラーを検出する

#### テストポイント:

- **コンパイル**: TypeScriptエラーの検出
- **最適化**: Next.jsビルド処理の成功
- **依存関係**: パッケージ間の整合性確認
- **静的ファイル**: アセット生成の確認

### コード品質テスト（高優先度）

保守性とコード品質を維持する

#### テストポイント:

- **デバッグコード除去**: console.log、debugger文の検出
- **未使用コード**: 不要なimport・関数・変数の検出
- **コーディング規約**: ESLintルール準拠
- **型安全性**: TypeScriptの型エラー検出

### コアコンポーネントテスト（中優先度）

ユーザー操作に直結するUI機能の品質を確保する

#### テストポイント:

- **イベント処理**: クリック・フォーム送信などの動作
- **状態管理**: コンポーネント内状態の正確な更新
- **条件表示**: 権限・状態による表示制御
- **エラーハンドリング**: UI上でのエラー表示・処理

#### 対象コンポーネント:

- 認証関連（ログインボタン）
- データ操作（ドキュメントカード、モーダル）
- ナビゲーション（サイドナビ）

### データ取得系API テスト（中優先度）

データフェッチ処理の信頼性を確保する

#### テストポイント:

- **データ取得**: 正しいクエリでのデータ取得
- **フィルタリング**: 削除フラグやユーザー権限による絞り込み
- **エラーハンドリング**: 取得失敗時の適切な処理
- **パフォーマンス**: レスポンス時間の妥当性

### ページレベル統合テスト（中低優先度）

ページ全体の機能統合を確認する

#### テストポイント:

- **データ連携**: API・コンポーネント間のデータ流れ
- **ページ遷移**: 認証状態によるリダイレクト
- **レイアウト**: 画面表示の正確性
- **パフォーマンス**: ページ読み込み速度

### UIコンポーネントテスト（中低優先度）

表示専用コンポーネントの表示を確認する

#### テストポイント:

- **表示内容**: 渡されたpropsの正確な表示
- **スタイリング**: 基本的なCSS適用確認
- **アクセシビリティ**: 基本的なa11y要件

### E2Eテスト（低優先度）

ユーザージャーニー全体を動作確認する

#### テストポイント:

- **ユーザーフロー**: ログインから主要機能利用まで
- **ブラウザ互換性**: 主要ブラウザでの動作確認
- **パフォーマンス**: 実環境での応答性能
- **回帰テスト**: 機能追加・修正時の既存機能への影響確認

### Supabase 統合テスト（低優先度）

外部サービス連携を確認する

#### テストポイント:

- **接続確認**: データベース・認証サービスとの通信
- **設定確認**: 環境変数・設定値の正確性
- **制約確認**: DB制約・RLSポリシーの動作
